{"version":3,"file":"typed-messages.min.js","sources":["../../../node_modules/@babel/runtime/helpers/defineProperty.js","../../../node_modules/@babel/runtime/helpers/createClass.js","../../../node_modules/@babel/runtime/helpers/inheritsLoose.js","../src/storage.js","../src/realtime.js","../src/file-message.js","../src/image-message.js","../src/audio-message.js","../src/video-message.js","../src/location-message.js","../src/index.js"],"sourcesContent":["function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}\n\nmodule.exports = _inheritsLoose;","/* eslint-disable import/no-unresolved */\nimport { File } from 'leancloud-storage';\n\nif (!File) {\n  throw new Error('LeanCloud Storage SDK not installed');\n}\n\nexport { File, GeoPoint } from 'leancloud-storage';\n","/* eslint-disable import/no-unresolved */\nimport { TypedMessage } from 'leancloud-realtime';\n\nif (!TypedMessage) {\n  throw new Error('LeanCloud Realtime SDK not installed');\n}\n\nexport {\n  TypedMessage,\n  messageType,\n  messageField,\n  IE10Compatible,\n} from 'leancloud-realtime';\n","import { File } from './storage';\nimport {\n  TypedMessage,\n  messageType,\n  messageField,\n  IE10Compatible,\n} from './realtime';\n\nexport default class FileMessage extends TypedMessage {\n  /**\n   * @extends TypedMessage\n   * @param  {AV.File} file LeanCloud 存储 SDK 中的 AV.File 实例，且必须是已经保存到服务端上的 File 实例\n   * （如果是刚刚创建的，必须 save 后才能用于创建 FileMessage）\n   */\n  constructor(file) {\n    if (!(file instanceof File)) {\n      throw new TypeError('file must be an AV.File');\n    }\n    if (typeof file.id !== 'string') {\n      throw new Error('file must be saved before used to create a Message');\n    }\n    super();\n    this._file = file;\n    this._lcfile = {\n      objId: file.id,\n      url: file.url(),\n      metaData: Object.assign(file.metaData() || {}, {\n        name: file.name(),\n      }),\n    };\n  }\n\n  /**\n   * 在客户端需要以文本形式展示该消息时显示的文案，格式为 <code>[类型] file.name()</code>\n   * @type {String}\n   * @readonly\n   */\n  get summary() {\n    return `[${this.constructor._summaryType}] ${this._file.name() ||\n      ''}`.trim();\n  }\n\n  /**\n   * 获得 file 对象\n   * @return {AV.File}\n   */\n  getFile() {\n    return this._file;\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      file: this.getFile().toJSON(),\n    };\n  }\n\n  static _parseFileFromRawData(data) {\n    if (!(data && data._lcfile)) {\n      throw new Error('malformed FileMessage content');\n    }\n    let id = data._lcfile.objId;\n    if (typeof id !== 'string') {\n      id = '';\n    }\n    const file = File.createWithoutData(id);\n    file.attributes = file.attributes || {};\n    file._url = data._lcfile.url;\n    file.attributes.url = file._url;\n    file._metaData = data._lcfile.metaData || {};\n    file.attributes.metaData = file._metaData;\n    if (data._lcfile.metaData) {\n      file._name = data._lcfile.metaData.name;\n      file.attributes.name = file._name;\n    }\n    return file;\n  }\n\n  static parse(json, message) {\n    const file = this._parseFileFromRawData(json);\n    return TypedMessage.parse(json, message || new this(file));\n  }\n}\n\nFileMessage._summaryType = '文件';\n\n/**\n * @name TYPE\n * @memberof FileMessage\n * @type Number\n * @static\n * @const\n */\nmessageType(-6)(FileMessage);\nmessageField('_lcfile')(FileMessage);\nIE10Compatible(FileMessage);\n","import FileMessage from './file-message';\nimport { messageType, IE10Compatible } from './realtime';\n\n/**\n * 构造方法参数同 {@link FileMessage}\n *\n * @extends FileMessage\n */\nclass ImageMessage extends FileMessage {}\nImageMessage._summaryType = '图片';\n\n/**\n * @name TYPE\n * @memberof ImageMessage\n * @type Number\n * @static\n * @const\n */\nmessageType(-2)(ImageMessage);\nIE10Compatible(ImageMessage);\n\nexport default ImageMessage;\n","import FileMessage from './file-message';\nimport { messageType, IE10Compatible } from './realtime';\n\n/**\n * 构造方法参数同 {@link FileMessage}\n *\n * @extends FileMessage\n */\nclass AudioMessage extends FileMessage {}\nAudioMessage._summaryType = '语音';\n\n/**\n * @name TYPE\n * @memberof AudioMessage\n * @type Number\n * @static\n * @const\n */\nmessageType(-3)(AudioMessage);\nIE10Compatible(AudioMessage);\n\nexport default AudioMessage;\n","import FileMessage from './file-message';\nimport { messageType, IE10Compatible } from './realtime';\n\n/**\n * 构造方法参数同 {@link FileMessage}\n *\n * @extends FileMessage\n */\nclass VideoMessage extends FileMessage {}\nVideoMessage._summaryType = '视频';\n\n/**\n * @name TYPE\n * @memberof VideoMessage\n * @type Number\n * @static\n * @const\n */\nmessageType(-4)(VideoMessage);\nIE10Compatible(VideoMessage);\n\nexport default VideoMessage;\n","import { GeoPoint } from './storage';\nimport {\n  TypedMessage,\n  messageType,\n  messageField,\n  IE10Compatible,\n} from './realtime';\n\nexport default class LocationMessage extends TypedMessage {\n  /**\n   * @extends TypedMessage\n   * @param  {AV.GeoPoint} geoPoint LeanCloud 存储 SDK 中的 AV.GeoPoint 实例\n   */\n  constructor(geoPoint) {\n    if (!(geoPoint instanceof GeoPoint)) {\n      throw new TypeError('geoPoint must be an AV.GeoPoint');\n    }\n    super();\n    this._geoPoint = geoPoint;\n    const { latitude, longitude } = geoPoint;\n    this._lcloc = { latitude, longitude };\n  }\n\n  /**\n   * 在客户端需要以文本形式展示该消息时显示的文案，格式为 <code>[位置] message.text</code>\n   * @type {String}\n   * @readonly\n   */\n  get summary() {\n    return `[位置] ${this.text || ''}`.trim();\n  }\n\n  /**\n   * 获得 geoPoint 对象\n   * @return {AV.GeoPoint}\n   */\n  getLocation() {\n    return this._geoPoint;\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      location: this.getLocation().toJSON(),\n    };\n  }\n\n  static parse(json, message) {\n    const { latitude, longitude } = json._lcloc;\n    const geoPoint = new GeoPoint({ latitude, longitude });\n    return TypedMessage.parse(json, message || new this(geoPoint));\n  }\n}\n\n/**\n * @name TYPE\n * @memberof LocationMessage\n * @type Number\n * @static\n * @const\n */\nmessageType(-5)(LocationMessage);\nmessageField('_lcloc')(LocationMessage);\nIE10Compatible(LocationMessage);\n","/** @module leancloud-realtime-plugin-typed-messages */\n\nimport FileMessage from './file-message';\nimport ImageMessage from './image-message';\nimport AudioMessage from './audio-message';\nimport VideoMessage from './video-message';\nimport LocationMessage from './location-message';\nimport { name } from '../package.json';\n\n/**\n * TypedMessages 插件，使用后可支持接收 LeanCloud 提供的富媒体类型的消息\n * @example\n * var realtime = new Realtime({\n *   appId: appId,\n *   appKey: appKey,\n *   server: server,\n *   plugins: TypedMessagesPlugin,\n * });\n */\nexport const TypedMessagesPlugin = {\n  name,\n  messageClasses: [\n    FileMessage,\n    ImageMessage,\n    AudioMessage,\n    VideoMessage,\n    LocationMessage,\n  ],\n};\n\nexport {\n  /**\n   * @see FileMessage\n   */\n  FileMessage,\n  /**\n   * @see ImageMessage\n   */\n  ImageMessage,\n  /**\n   * @see AudioMessage\n   */\n  AudioMessage,\n  /**\n   * @see VideoMessage\n   */\n  VideoMessage,\n  /**\n   * @see LocationMessage\n   */\n  LocationMessage,\n};\n"],"names":["obj","key","value","Object","defineProperty","enumerable","configurable","writable","_defineProperties","target","props","i","length","descriptor","Constructor","protoProps","staticProps","prototype","subClass","superClass","create","constructor","__proto__","File","Error","TypedMessage","FileMessage","file","TypeError","id","_file","_lcfile","objId","url","metaData","assign","name","getFile","this","toJSON","_parseFileFromRawData","data","createWithoutData","attributes","_url","_metaData","_name","parse","json","message","_summaryType","trim","ImageMessage","AudioMessage","VideoMessage","LocationMessage","geoPoint","GeoPoint","_geoPoint","latitude","longitude","_lcloc","getLocation","location","text","TypedMessagesPlugin","messageClasses"],"mappings":"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"}